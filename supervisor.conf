[supervisord]
nodaemon=true
logfile=/var/log/supervisord.log
pidfile=/var/run/supervisord.pid

[program:gunicorn]
command=gunicorn --bind 0.0.0.0:8000 --workers 4 --threads 2 app:app
directory=/app
user=appuser
autostart=true
autorestart=true
stdout_logfile=/var/log/gunicorn.log
stderr_logfile=/var/log/gunicorn.err.log
environment=
    FLASK_APP="app.py",
    FLASK_ENV="production",
    PYTHONPATH="/app"

[program:redis]
command=redis-server
autostart=true
autorestart=true
stdout_logfile=/var/log/redis.log
stderr_logfile=/var/log/redis.err.log

[program:celery]
command=celery -A app.celery worker --loglevel=info
directory=/app
user=appuser
numprocs=1
autostart=true
autorestart=true
stdout_logfile=/var/log/celery.log
stderr_logfile=/var/log/celery.err.log
environment=
    FLASK_APP="app.py",
    FLASK_ENV="production",
    C_FORCE_ROOT="true"

[program:celery-beat]
command=celery -A app.celery beat --loglevel=info
directory=/app
user=appuser
numprocs=1
autostart=true
autorestart=true
stdout_logfile=/var/log/celery-beat.log
stderr_logfile=/var/log/celery-beat.err.log
environment=
    FLASK_APP="app.py",
    FLASK_ENV="production" 